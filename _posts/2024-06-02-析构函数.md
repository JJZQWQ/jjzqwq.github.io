---
layout:     post
title:      C++面向对象
subtitle:   我的疑问
date:       2024-06-02
author:     陈佳兴
header-img: img/the-first.png
catalog:   true
tags:
    - C++笔记
---
# 面向对象
## 析构函数
在C++中，析构函数是一个特殊的成员函数，它在对象生命周期结束时自动执行，用于进行清理工作，比如释放资源、关闭文件等。析构函数的执行时机取决于对象的存储期和作用域：

1. **局部对象**：当局部对象的作用域结束时（例如，一个函数内部创建的对象在函数返回时），其析构函数会被调用。

2. **静态局部对象**：静态局部对象在程序的整个运行期间存在，它们的析构函数通常在`main`函数结束后、程序完全结束前被调用。

3. **全局对象**：全局对象的析构函数在程序结束执行时被调用，通常在所有`main`函数的活动都完成后。

4. **动态分配的对象**：对于通过`new`操作符动态创建的对象，析构函数在`delete`操作符被显式调用时执行。

5. **临时对象**：临时对象（例如函数返回的对象）的析构函数通常在表达式结束时被调用。

6. **通过智能指针管理的对象**：例如，使用`std::unique_ptr`或`std::shared_ptr`管理的对象，其析构函数在智能指针的生命周期结束时被调用，例如智能指针本身被销毁或重置。

这些规则确保了资源的正确管理和释放，避免了内存泄漏等问题。理解析构函数的执行时机对于编写稳定和高效的C++程序至关重要。

## 宏定义
宏定义是C和C++中一种强大的预处理器功能，它允许您在编译之前对代码进行文本替换。 通过使用宏定义，您可以创建简单的代码片段替换或者更复杂的函数式宏，以提高代码的可读性、重用性和灵活性。

在C/C++中，宏定义使用指令来定义，并遵循以下格式：#define
#define MACRO_NAME replacement
其中MACRO_NAME是宏的名称，replacement是要替换的文本。
#define PI 3.14159
在这个例子中，PI是宏的名称，3.14159是要替换为的文本。 在代码中任何出现PI的地方都会被替换为3.14159

宏定义可以接受参数，使其更加灵活。 例如，您可以创建带有参数的宏来模拟函数的行为：
#define SQUARE(x) ((x) * (x))
在这个例子中，SQUARE(x)是一个带有参数的宏，它会将传入的参数求平方并返回结果。 在代码中，可以像使用函数一样调用宏：SQUARE
int result = SQUARE(5); // 这将被展开为 int result = ((5) * (5));

需要注意的是，宏定义只是简单的文本替换，因此在使用宏定义时要小心，确保替换后的代码符合预期。 此外，宏定义不能提供类型检查和作用域规则，因此在某些情况下，使用宏可能会导致意外行为或错误。

总的来说，宏定义是C和C++中一个有用的工具，可以用来创建常量、简化代码、以及实现类似函数的行为。 然而，要谨慎使用宏定义，并在可能的情况下考虑使用函数或其他更安全的替代方法。

## 预处理与编译及运行
在C和C++编程中，代码通常需要经历预处理、编译和运行三个主要阶段。

预处理阶段：
在预处理阶段，预处理器会处理以#开头的预处理指令，如#include#ifdef、#等。
预处理器会根据这些指令进行文本替换、文件包含等操作，生成一个经过预处理的源文件。
例如，#include <stdio.h>指令会将stdio.h文件的内容插入到源文件中，#define指令会创建宏定义等。

编译阶段：
在编译阶段，编译器会将预处理后的源文件转换为汇编代码。
编译器会进行词法分析、语法分析、语义分析等操作，检查代码是否符合语法规则和语义要求，并生成相应的中间代码或汇编代码。
如果代码中存在错误，编译器会产生编译错误，并提示开发人员进行修正。

链接阶段（对于多个源文件的情况）：
如果程序由多个源文件组成，编译器会将每个源文件编译为相应的目标文件（通常是.o或.obj格式）。
链接器会将这些目标文件及其所需的库文件链接在一起，生成可执行文件。
链接器还会解析符号引用，确保程序中的函数和变量都能正确地连接在一起。

运行阶段：
最终生成的可执行文件可以通过操作系统加载到内存中执行。
程序开始执行，按照编写的逻辑进行运行。
如果程序中存在输入输出，程序可能会与用户交互或者读写文件。
总的来说，预处理阶段在编译之前对代码进行简单的文本替换和处理，编译阶段将代码转换为目标代码，链接阶段将多个目标文件链接在一起生成可执行文件，最后在运行阶段执行程序。 这是C和C++代码从源代码到可执行文件的主要流程。
